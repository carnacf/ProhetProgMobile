package com.example.nairolf.projetprogmobile;import android.content.Intent;import android.content.SharedPreferences;import android.content.pm.ActivityInfo;import android.database.Etudiant;import android.database.EtudiantManager;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.text.Editable;import android.text.TextWatcher;import android.view.View;import android.widget.ArrayAdapter;import android.widget.AutoCompleteTextView;import android.widget.DatePicker;import android.widget.EditText;import android.widget.Spinner;import java.io.UnsupportedEncodingException;import java.nio.charset.StandardCharsets;import java.nio.charset.UnsupportedCharsetException;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Date;public class Inscription extends AppCompatActivity {    SharedPreferences sp;    SharedPreferences.OnSharedPreferenceChangeListener spChanged;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LOCKED);        sp = getBaseContext().getSharedPreferences("mode", MODE_PRIVATE);        String s = sp.getString("mode","test");        if (s == "dark") {            setTheme(R.style.ActivityTheme_Primary_Base_Dark);        }else if(s == "light"){            setTheme(R.style.ActivityTheme_Primary_Base_Light);        }        spChanged = new SharedPreferences.OnSharedPreferenceChangeListener() {            @Override            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences,                                                  String key) {                if (key == "mode") {                    recreate();                }            }        };        sp.registerOnSharedPreferenceChangeListener(spChanged);        setContentView(R.layout.activity_inscription);        Spinner dropdown1 = (Spinner)findViewById(R.id.Etude);        String[] items1 = new String[]{"Licence1","Licence2","Licence3","Master1","Master2", "Doctorat"};        ArrayAdapter<String> adapter1 = new ArrayAdapter<String>(this, android.R.layout.simple_spinner_dropdown_item, items1);        dropdown1.setAdapter(adapter1);        Spinner dropdown2 = (Spinner)findViewById(R.id.Section);        String[] items2 = new String[]{"Chimie","EEA","Informatique","Math-Info","Mathématiques","Mecanique","Physique","Sciences de la Terre","Science de la vie","Science et technologies"};        ArrayAdapter<String> adapter2 = new ArrayAdapter<String>(this, android.R.layout.simple_spinner_dropdown_item, items2);        dropdown2.setAdapter(adapter2);        DatePicker date = (DatePicker)findViewById(R.id.datepicker);        date.setMaxDate(new Date().getTime());        date.init(1990,1,1,null);        final AutoCompleteTextView actv = (AutoCompleteTextView)findViewById(R.id.MailIns);        actv.addTextChangedListener(new TextWatcher() {            @Override            public void beforeTextChanged(CharSequence s, int start, int count, int after) {            }            @Override            public void onTextChanged(CharSequence s, int start, int before, int count) {                String[] tab = new String[]{s.toString()+"@etu.umontpellier.fr"};                ArrayAdapter<String> adapter = new ArrayAdapter<String>(Inscription.this, android.R.layout.simple_dropdown_item_1line,tab );                actv.setAdapter(adapter);            }            @Override            public void afterTextChanged(Editable s) {            }        });    }    public void retourCo(View view){        Intent intent = new Intent(this,Connection.class);        startActivity(intent);    }    public void valider(View view) throws NoSuchAlgorithmException,UnsupportedEncodingException{        boolean b = true;        EditText nom = (EditText)findViewById(R.id.NomIns);        if(nom.getText().toString().equals("")){            nom.setError("Ce champ est obligatoire !");            b = false;        }        EditText prenom = (EditText)findViewById(R.id.PrenomIns);        if(prenom.getText().toString().equals("")){            prenom.setError("Ce champ est obligatoire !");            b = false;        }        EditText pass = (EditText)findViewById(R.id.MDPIns);        EditText passVal = (EditText)findViewById(R.id.MDPInsVal);        if(pass.getText().toString().equals("")){            pass.setError("Ce champ est obligatoire !");            b = false;        }        if(passVal.getText().toString().equals("")){            passVal.setError("Ce champ est obligatoire !");            b = false;        }        if(!pass.getText().toString().equals(passVal.getText().toString())){            passVal.setError("Les deux mots de passe doivent être identques !");            b = false;        }        EditText mail = (EditText)findViewById(R.id.MailIns);        if(mail.getText().toString().equals("")){            mail.setError("Ce champ est obligatoire !");            b = false;        }else if(!mail.getText().toString().endsWith("@etu.umontpellier.fr")){            mail.setError("L'adresse mail n'est pas correcte !");            b = false;        }        if(b){            DatePicker date = (DatePicker)findViewById(R.id.datepicker);            Spinner niveau = (Spinner)findViewById(R.id.Etude);            Spinner spe = (Spinner)findViewById(R.id.Section);            int day = date.getDayOfMonth();            int month = date.getMonth();            int year = date.getYear();            MessageDigest digest = MessageDigest.getInstance("SHA-256");            String mdp = digest.digest(pass.getText().toString().getBytes("UTF-8")).toString();            EtudiantManager em = new EtudiantManager(this);            em.open();            em.addEtudiant(new Etudiant(0,                    nom.getText().toString(),prenom.getText().toString(),                    pass.getText().toString(),                    day+"/"+month+"/"+year,                    mail.getText().toString(),                    niveau.getSelectedItem().toString(),                    spe.getSelectedItem().toString()));            Intent intent = new Intent(this,Connection.class);            startActivity(intent);        }    }}